{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/user-bio/./node_modules/autolink-js/autolink-min.js","webpack://@fof/user-bio/webpack/bootstrap","webpack://@fof/user-bio/webpack/runtime/compat get default export","webpack://@fof/user-bio/webpack/runtime/define property getters","webpack://@fof/user-bio/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/user-bio/webpack/runtime/make namespace object","webpack://@fof/user-bio/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['forum/components/UserCard']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/models/User']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/user-bio/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/user-bio/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/components/Button']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@fof/user-bio/./src/forum/components/UserBio.js","webpack://@fof/user-bio/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/user-bio/./src/forum/components/index.js","webpack://@fof/user-bio/./src/forum/index.js"],"sourcesContent":["(function(){var h=[].slice;String.prototype.autoLink=function(){var b,f,d,a,e,g;a=1<=arguments.length?h.call(arguments,0):[];e=/(^|[\\s\\n]|<[A-Za-z]*\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi;if(!(0<a.length))return this.replace(e,\"$1<a href='$2'>$2</a>\");d=a[0];f=function(){var c;c=[];for(b in d)g=d[b],\"callback\"!==b&&c.push(\" \"+b+\"='\"+g+\"'\");return c}().join(\"\");return this.replace(e,function(c,b,a){c=(\"function\"===typeof d.callback?d.callback(a):\nvoid 0)||\"<a href='\"+a+\"'\"+f+\">\"+a+\"</a>\";return\"\"+b+c})}}).call(this);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserCard'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Button from 'flarum/common/components/Button';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\n\n/**\n * The `UserBio` component displays a user's bio, optionally letting the user\n * edit it.\n */\nexport default class UserBio extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    /**\n     * Whether the bio is currently being edited.\n     *\n     * @type {boolean}\n     */\n    this.editing = false;\n\n    /**\n     * Whether the bio is currently being saved.\n     *\n     * @type {boolean}\n     */\n    this.loading = false;\n\n    /**\n     * The rows to show in the textarea by default when editing.\n     * This is set to 5 by default, but can be overridden by the `--bio-max-lines` CSS variable.\n     *\n     * @type {string}\n     */\n    this.textareaRows = '5';\n\n    /**\n     * The max configured character count the bio may be\n     */\n    this.bioMaxLength = app.forum.attribute('fof-user-bio.maxLength');\n\n    /**\n     * The placeholder shown in the bio textbox when no input is set.\n     */\n    this.bioPlaceholder =\n      app.session && app.session.user && app.session.user.id() === this.attrs.user.id()\n        ? // Normal placeholder if they're looking at their own profile\n          app.translator.trans('fof-user-bio.forum.userbioPlaceholder')\n        : // Special placeholder if someone else is viewing their profile with edit access\n          app.translator.trans('fof-user-bio.forum.userbioPlaceholderOtherUser', {\n            username: this.attrs.user.displayName(),\n          });\n  }\n\n  view() {\n    const user = this.attrs.user;\n    const editable = this.attrs.editable && this.attrs.user.attribute('canEditBio');\n    let content;\n\n    if (this.editing) {\n      const tempBio = this.tempBio;\n      const value = tempBio ?? user.bio();\n\n      const focusIfErrored = (vnode) => {\n        const textarea = vnode.dom;\n\n        textarea.value = value;\n\n        if (tempBio !== undefined) {\n          textarea.value = tempBio;\n          textarea.focus();\n\n          if (this.tempSelector !== undefined) {\n            textarea.selectionStart = this.tempSelector;\n            textarea.selectionEnd = this.tempSelector;\n\n            delete this.tempSelector;\n          }\n        }\n      };\n\n      content = (\n        <form onsubmit={this.save.bind(this)}>\n          <textarea\n            className=\"FormControl\"\n            placeholder={extractText(this.bioPlaceholder)}\n            rows={this.textareaRows}\n            maxlength={this.bioMaxLength}\n            oncreate={focusIfErrored}\n          />\n          <div className=\"UserBio-actions\">\n            <Button className=\"Button Button--primary\" type=\"submit\">\n              {app.translator.trans('fof-user-bio.forum.profile.save_button')}\n            </Button>\n            <Button className=\"Button\" type=\"reset\" onclick={this.reset.bind(this)}>\n              {app.translator.trans('fof-user-bio.forum.profile.cancel_button')}\n            </Button>\n          </div>\n        </form>\n      );\n    } else {\n      let subContent;\n\n      if (this.loading) {\n        subContent = (\n          <p className=\"UserBio-placeholder\">\n            <LoadingIndicator />\n          </p>\n        );\n      } else {\n        const bioHtml = user.bioHtml();\n\n        if (bioHtml) {\n          subContent = m.trust(bioHtml);\n        } else if (user.bio()) {\n          subContent = m.trust(\n            '<p>' + $('<div/>').text(user.bio()).html().replace(/\\n/g, '<br>').autoLink({ rel: 'nofollow ugc', target: '_blank' }) + '</p>'\n          );\n        } else if (editable) {\n          subContent = <p className=\"UserBio-placeholder\">{this.bioPlaceholder}</p>;\n        }\n      }\n\n      const maxLines = app.forum.attribute('fof-user-bio.maxLines') || 5;\n\n      content = (\n        <div\n          className=\"UserBio-content\"\n          // onclick={editable ? this.edit.bind(this) : () => undefined}\n          onclick={editable ? this.edit.bind(this) : () => undefined}\n          onkeydown={editable ? this.onkeydown.bind(this) : () => undefined}\n          style={{ '--bio-max-lines': maxLines }}\n          role={editable ? 'button' : undefined}\n          tabindex={editable ? '0' : undefined}\n          aria-label={editable ? app.translator.trans('fof-user-bio.forum.profile.edit_bio_label') : undefined}\n        >\n          {subContent}\n        </div>\n      );\n    }\n\n    return (\n      <div\n        className={\n          'UserBio ' +\n          classList({\n            editable,\n            editing: this.editing,\n          })\n        }\n      >\n        {content}\n      </div>\n    );\n  }\n\n  onkeydown(e) {\n    // Allow keyboard navigation to turn editing mode on\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      this.edit(e);\n    }\n  }\n\n  /**\n   * Edit the bio.\n   * @param {MouseEvent} e\n   */\n  edit(e) {\n    // If the click is special, do not switch to editing mode.\n    // e.g. allows for Ctrl+Click to open a link in a new tab\n    if (e.ctrlKey || e.metaKey) return;\n\n    e.preventDefault();\n\n    // Maintain the scroll position & cursor position when editing\n    const selection = window.getSelection();\n    const lineIndex = selection.anchorOffset;\n\n    // Sometimes, links are clicked and the anchorNode is either null or the UserBio-content itself\n    const clickedNode = !selection.anchorNode || !e.target.className.includes('UserBio') ? e.target : selection.anchorNode;\n    const lengthBefore = this.countTextLengthBefore(clickedNode);\n\n    const currentScroll = e.currentTarget.scrollTop;\n    const index = lengthBefore + lineIndex;\n\n    // Show the same number of lines to avoid layout shift\n    this.textareaRows = getComputedStyle(e.currentTarget).getPropertyValue('--bio-max-lines') || '5';\n\n    this.editing = true;\n    m.redraw.sync();\n\n    this.$('textarea').trigger('focus').prop('selectionStart', index).prop('selectionEnd', index).prop('scrollTop', currentScroll);\n  }\n\n  /**\n   * Save the bio.\n   */\n  save(e) {\n    e.preventDefault();\n\n    const value = this.$('textarea').val();\n    const user = this.attrs.user;\n    const tempSelector = this.$('textarea').prop('selectionStart');\n\n    // Don't constantly try to save when blurring textarea\n    if (this.isDirty()) {\n      this.loading = true;\n\n      user\n        .save({ bio: value })\n        .catch(() => {\n          this.tempBio = value;\n          this.tempSelector = tempSelector;\n          this.edit();\n        })\n        .then(() => {\n          this.loading = false;\n          delete this.tempBio;\n          m.redraw();\n        });\n    }\n\n    this.editing = false;\n    m.redraw();\n  }\n\n  reset(e) {\n    // Don't want to actually reset the form\n    e.preventDefault();\n\n    // Either nothing changed or we want to confirm the loss of changes\n    if (!this.isDirty() || confirm(extractText(app.translator.trans('fof-user-bio.forum.profile.cancel_confirm')))) {\n      this.editing = false;\n      delete this.tempBio;\n      m.redraw();\n    }\n  }\n\n  isDirty() {\n    const value = this.$('textarea').val();\n    const user = this.attrs.user;\n\n    return user.bio() !== value;\n  }\n\n  /**\n   *\n   * @param {Node} anchorNode\n   * @returns {number}\n   */\n  countTextLengthBefore(anchorNode) {\n    if (!anchorNode || (anchorNode instanceof HTMLElement && anchorNode.className.includes('UserBio'))) return 0;\n\n    let length = 0;\n\n    if (anchorNode.previousSibling) {\n      for (let prev = anchorNode.previousSibling; prev; prev = prev.previousSibling) {\n        length += prev.textContent.length;\n      }\n    }\n\n    const parent = anchorNode.parentNode;\n\n    // We need to recursively call this function if the anchorNode is not a direct child of UserBio-content\n    return length + this.countTextLengthBefore(anchorNode.parentNode);\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import UserBio from './UserBio';\n\nexport const components = {\n  UserBio,\n};\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport 'autolink-js';\nimport UserCard from 'flarum/forum/components/UserCard';\nimport User from 'flarum/common/models/User';\nimport Model from 'flarum/common/Model';\nimport UserBio from './components/UserBio';\n\nexport * from './components';\n\napp.initializers.add('fof-user-bio', () => {\n  User.prototype.bio = Model.attribute('bio');\n  User.prototype.bioHtml = Model.attribute('bioHtml');\n\n  extend(UserCard.prototype, 'infoItems', function (items) {\n    let user = this.attrs.user;\n\n    if (!user.attribute('canViewBio')) {\n      return;\n    }\n\n    items.add('bio', <UserBio user={user} editable={this.attrs.editable} />, -100);\n  });\n});\n"],"names":["h","slice","String","prototype","autoLink","b","f","d","a","e","g","arguments","length","call","c","push","join","this","replace","callback","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","hasOwnProperty","r","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","__proto__","UserBio","_Component","subClass","superClass","apply","create","constructor","_proto","oninit","vnode","editing","loading","textareaRows","bioMaxLength","app","attribute","bioPlaceholder","user","id","attrs","trans","username","displayName","view","content","_this","editable","tempBio","bio","m","onsubmit","save","bind","className","placeholder","extractText","rows","maxlength","oncreate","textarea","dom","focus","tempSelector","selectionStart","selectionEnd","Button","type","onclick","reset","subContent","LoadingIndicator","bioHtml","trust","$","text","html","rel","target","maxLines","edit","onkeydown","style","role","tabindex","classList","preventDefault","ctrlKey","metaKey","selection","window","getSelection","lineIndex","anchorOffset","clickedNode","anchorNode","includes","lengthBefore","countTextLengthBefore","currentScroll","currentTarget","scrollTop","index","getComputedStyle","getPropertyValue","redraw","sync","trigger","_this2","val","isDirty","then","confirm","HTMLElement","previousSibling","prev","textContent","parentNode","Component","components","add","User","Model","extend","UserCard","items"],"sourceRoot":""}