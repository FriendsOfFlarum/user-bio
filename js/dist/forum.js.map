{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/user-bio/./node_modules/autolink-js/autolink-min.js","webpack://@fof/user-bio/webpack/bootstrap","webpack://@fof/user-bio/webpack/runtime/compat get default export","webpack://@fof/user-bio/webpack/runtime/define property getters","webpack://@fof/user-bio/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/user-bio/webpack/runtime/make namespace object","webpack://@fof/user-bio/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/utils/computed']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['forum/components/UserCard']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/models/User']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/user-bio/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/user-bio/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/user-bio/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@fof/user-bio/./src/forum/components/UserBio.js","webpack://@fof/user-bio/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/user-bio/./src/forum/components/index.js","webpack://@fof/user-bio/./src/forum/index.js"],"sourcesContent":["(function(){var h=[].slice;String.prototype.autoLink=function(){var b,f,d,a,e,g;a=1<=arguments.length?h.call(arguments,0):[];e=/(^|[\\s\\n]|<[A-Za-z]*\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi;if(!(0<a.length))return this.replace(e,\"$1<a href='$2'>$2</a>\");d=a[0];f=function(){var c;c=[];for(b in d)g=d[b],\"callback\"!==b&&c.push(\" \"+b+\"='\"+g+\"'\");return c}().join(\"\");return this.replace(e,function(c,b,a){c=(\"function\"===typeof d.callback?d.callback(a):\nvoid 0)||\"<a href='\"+a+\"'\"+f+\">\"+a+\"</a>\";return\"\"+b+c})}}).call(this);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/computed'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserCard'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\n\n/**\n * The `UserBio` component displays a user's bio, optionally letting the user\n * edit it.\n */\nexport default class UserBio extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    /**\n     * Whether or not the bio is currently being edited.\n     *\n     * @type {Boolean}\n     */\n    this.editing = false;\n\n    /**\n     * Whether or not the bio is currently being saved.\n     *\n     * @type {Boolean}\n     */\n    this.loading = false;\n\n    /**\n     * The max configured character count the bio may be\n     */\n    this.bioMaxLength = app.forum.attribute('fof-user-bio.maxLength');\n\n    /**\n     * The placeholder shown in the bio textbox when no input is set.\n     */\n    this.bioPlaceholder =\n      app.session && app.session.user && app.session.user.id() === this.attrs.user.id()\n        ? // Normal placeholder if they're looking at their own profile\n          app.translator.trans('fof-user-bio.forum.userbioPlaceholder')\n        : // Special placeholder if someone else is viewing their profile with edit access\n          app.translator.trans('fof-user-bio.forum.userbioPlaceholderOtherUser', {\n            username: this.attrs.user.username(),\n          });\n  }\n\n  view() {\n    const user = this.attrs.user;\n    const editable = this.attrs.user.attribute('canEditBio');\n    let content;\n\n    if (this.editing) {\n      const tempBio = this.tempBio;\n      const value = tempBio ?? user.bio();\n\n      const focusIfErrored = (vnode) => {\n        const textarea = vnode.dom;\n\n        textarea.value = value;\n\n        if (tempBio !== undefined) {\n          textarea.value = tempBio;\n          textarea.focus();\n\n          if (this.tempSelector !== undefined) {\n            textarea.selectionStart = this.tempSelector;\n            textarea.selectionEnd = this.tempSelector;\n\n            delete this.tempSelector;\n          }\n        }\n      };\n\n      content = (\n        <textarea\n          className=\"FormControl\"\n          placeholder={extractText(this.bioPlaceholder)}\n          rows=\"3\"\n          maxlength={this.bioMaxLength}\n          oncreate={focusIfErrored}\n        />\n      );\n    } else {\n      let subContent;\n\n      if (this.loading) {\n        subContent = (\n          <p className=\"UserBio-placeholder\">\n            <LoadingIndicator />\n          </p>\n        );\n      } else {\n        const bioHtml = user.bioHtml();\n\n        if (bioHtml) {\n          subContent = m.trust(bioHtml);\n        } else if (user.bio()) {\n          subContent = m.trust('<p>' + $('<div/>').text(user.bio()).html().replace(/\\n/g, '<br>').autoLink({ rel: 'nofollow ugc' }) + '</p>');\n        } else if (editable) {\n          subContent = <p className=\"UserBio-placeholder\">{this.bioPlaceholder}</p>;\n        }\n      }\n\n      const maxLines = app.forum.attribute('fof-user-bio.maxLines');\n\n      content = (\n        <div className=\"UserBio-content\" onclick={editable ? this.edit.bind(this) : () => undefined} style={{ '--bio-max-lines': maxLines }}>\n          {subContent}\n        </div>\n      );\n    }\n\n    return (\n      <div\n        className={\n          'UserBio ' +\n          classList({\n            editable,\n            editing: this.editing,\n          })\n        }\n      >\n        {content}\n      </div>\n    );\n  }\n\n  /**\n   * Edit the bio.\n   */\n  edit() {\n    this.editing = true;\n    m.redraw.sync();\n\n    const bio = this;\n    const save = function (e) {\n      if (e.shiftKey) return;\n      e.preventDefault();\n\n      bio.save(e.target.value, e.type === 'blur');\n    };\n\n    this.$('textarea').trigger('focus').on('blur', save).bind('keydown', 'return', save);\n    m.redraw();\n  }\n\n  /**\n   * Save the bio.\n   *\n   * @param {String} value\n   */\n  save(value, wasBlurred) {\n    const user = this.attrs.user;\n    const tempSelector = this.$('textarea').prop('selectionStart');\n\n    const shouldIgnore = wasBlurred && value === this.tempBio;\n\n    // Don't constantly try to save when blurring textarea\n    if (!shouldIgnore && user.bio() !== value) {\n      this.loading = true;\n\n      user\n        .save({ bio: value })\n        .catch(() => {\n          this.tempBio = value;\n          this.tempSelector = tempSelector;\n          this.edit();\n        })\n        .then(() => {\n          this.loading = false;\n          delete this.tempBio;\n          m.redraw();\n        });\n    }\n\n    if (shouldIgnore) {\n      delete this.tempBio;\n    }\n\n    this.editing = false;\n    m.redraw();\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import UserBio from './UserBio';\n\nexport const components = {\n  UserBio,\n};\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport 'autolink-js';\nimport computed from 'flarum/common/utils/computed';\nimport UserCard from 'flarum/forum/components/UserCard';\nimport User from 'flarum/common/models/User';\nimport Model from 'flarum/common/Model';\nimport UserBio from './components/UserBio';\n\nexport * from './components';\n\napp.initializers.add('fof-user-bio', () => {\n  User.prototype.bio = Model.attribute('bio');\n  User.prototype.bioHtml = Model.attribute('bioHtml');\n\n  extend(UserCard.prototype, 'infoItems', function (items) {\n    let user = this.attrs.user;\n\n    if (!user.attribute('canViewBio')) {\n      return;\n    }\n\n    items.add('bio', <UserBio user={user} />, -100);\n  });\n});\n"],"names":["h","slice","String","prototype","autoLink","b","f","d","a","e","g","arguments","length","call","c","push","join","this","replace","callback","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","hasOwnProperty","r","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","__proto__","UserBio","_Component","subClass","superClass","apply","create","constructor","_proto","oninit","vnode","editing","loading","bioMaxLength","app","attribute","bioPlaceholder","user","id","attrs","trans","username","view","content","_this","editable","tempBio","bio","m","className","placeholder","extractText","rows","maxlength","oncreate","textarea","dom","focus","tempSelector","selectionStart","selectionEnd","subContent","LoadingIndicator","bioHtml","trust","$","text","html","rel","maxLines","onclick","edit","bind","style","classList","redraw","sync","save","shiftKey","preventDefault","target","type","trigger","on","wasBlurred","_this2","shouldIgnore","then","Component","components","add","User","Model","extend","UserCard","items"],"sourceRoot":""}