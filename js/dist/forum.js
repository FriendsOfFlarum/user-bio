(()=>{var t={649:function(){(function(){var t=[].slice;String.prototype.autoLink=function(){var e,o,r,i,n,a;return n=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,0<(i=1<=arguments.length?t.call(arguments,0):[]).length?(r=i[0],o=function(){var t;for(e in t=[],r)a=r[e],"callback"!==e&&t.push(" "+e+"='"+a+"'");return t}().join(""),this.replace(n,(function(t,e,i){return""+e+(("function"==typeof r.callback?r.callback(i):void 0)||"<a href='"+i+"'"+o+">"+i+"</a>")}))):this.replace(n,"$1<a href='$2'>$2</a>")}}).call(this)}},e={};function o(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,o),n.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";o.r(r),o.d(r,{components:()=>_});const t=flarum.core.compat["forum/app"];var e=o.n(t);const i=flarum.core.compat["common/extend"];o(649);const n=flarum.core.compat["forum/components/UserCard"];var a=o.n(n);const s=flarum.core.compat["common/models/User"];var c=o.n(s);const l=flarum.core.compat["common/Model"];var u=o.n(l);function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}const p=flarum.core.compat["common/Component"];var d=o.n(p);const h=flarum.core.compat["common/components/LoadingIndicator"];var b=o.n(h);const v=flarum.core.compat["common/components/Button"];var g=o.n(v);const y=flarum.core.compat["common/utils/classList"];var x=o.n(y);const B=flarum.core.compat["common/utils/extractText"];var S=o.n(B),w=function(t){var o,r;function i(){return t.apply(this,arguments)||this}r=t,(o=i).prototype=Object.create(r.prototype),o.prototype.constructor=o,f(o,r);var n=i.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.editing=!1,this.loading=!1,this.textareaRows="5",this.bioMaxLength=e().forum.attribute("fof-user-bio.maxLength"),this.bioPlaceholder=e().session&&e().session.user&&e().session.user.id()===this.attrs.user.id()?e().translator.trans("fof-user-bio.forum.userbioPlaceholder"):e().translator.trans("fof-user-bio.forum.userbioPlaceholderOtherUser",{username:this.attrs.user.displayName()})},n.view=function(){var t,o=this,r=this.attrs.user,i=this.attrs.editable&&this.attrs.user.attribute("canEditBio");if(this.editing){var n=this.tempBio,a=null!=n?n:r.bio();t=m("form",{onsubmit:this.save.bind(this)},m("textarea",{className:"FormControl",placeholder:S()(this.bioPlaceholder),rows:this.textareaRows,maxlength:this.bioMaxLength,oncreate:function(t){var e=t.dom;e.value=a,void 0!==n&&(e.value=n,e.focus(),void 0!==o.tempSelector&&(e.selectionStart=o.tempSelector,e.selectionEnd=o.tempSelector,delete o.tempSelector))}}),m("div",{className:"UserBio-actions"},m(g(),{className:"Button Button--primary",type:"submit"},e().translator.trans("fof-user-bio.forum.profile.save_button")),m(g(),{className:"Button",type:"reset",onclick:this.reset.bind(this)},e().translator.trans("fof-user-bio.forum.profile.cancel_button"))))}else{var s;if(this.loading)s=m("p",{className:"UserBio-placeholder"},m(b(),null));else{var c=r.bioHtml();c?s=m.trust(c):r.bio()?s=m.trust("<p>"+$("<div/>").text(r.bio()).html().replace(/\n/g,"<br>").autoLink({rel:"nofollow ugc",target:"_blank"})+"</p>"):i&&(s=m("p",{className:"UserBio-placeholder"},this.bioPlaceholder))}var l=e().forum.attribute("fof-user-bio.maxLines")||5;t=m("div",{className:"UserBio-content",onclick:i?this.edit.bind(this):function(){},onkeydown:i?this.onkeydown.bind(this):function(){},style:{"--bio-max-lines":l},role:i?"button":void 0,tabindex:i?"0":void 0,"aria-label":i?e().translator.trans("fof-user-bio.forum.profile.edit_bio_label"):void 0},s)}return m("div",{className:"UserBio "+x()({editable:i,editing:this.editing})},t)},n.onkeydown=function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.edit(t))},n.edit=function(t){if(!t.ctrlKey&&!t.metaKey){t.preventDefault();var e=window.getSelection(),o=e.anchorOffset,r=e.anchorNode&&t.target.className.includes("UserBio")?e.anchorNode:t.target,i=this.countTextLengthBefore(r),n=t.currentTarget.scrollTop,a=i+o;this.textareaRows=getComputedStyle(t.currentTarget).getPropertyValue("--bio-max-lines")||"5",this.editing=!0,m.redraw.sync(),this.$("textarea").trigger("focus").prop("selectionStart",a).prop("selectionEnd",a).prop("scrollTop",n)}},n.save=function(t){var e=this;t.preventDefault();var o=this.$("textarea").val(),r=this.attrs.user,i=this.$("textarea").prop("selectionStart");this.isDirty()&&(this.loading=!0,r.save({bio:o}).catch((function(){e.tempBio=o,e.tempSelector=i,e.edit()})).then((function(){e.loading=!1,delete e.tempBio,m.redraw()}))),this.editing=!1,m.redraw()},n.reset=function(t){t.preventDefault(),this.isDirty()&&!confirm(S()(e().translator.trans("fof-user-bio.forum.profile.cancel_confirm")))||(this.editing=!1,delete this.tempBio,m.redraw())},n.isDirty=function(){var t=this.$("textarea").val();return this.attrs.user.bio()!==t},n.countTextLengthBefore=function(t){if(!t||t instanceof HTMLElement&&t.className.includes("UserBio"))return 0;var e=0;if(t.previousSibling)for(var o=t.previousSibling;o;o=o.previousSibling)e+=o.textContent.length;return t.parentNode,e+this.countTextLengthBefore(t.parentNode)},i}(d()),_={UserBio:w};e().initializers.add("fof-user-bio",(function(){c().prototype.bio=u().attribute("bio"),c().prototype.bioHtml=u().attribute("bioHtml"),(0,i.extend)(a().prototype,"infoItems",(function(t){var e=this.attrs.user;e.attribute("canViewBio")&&t.add("bio",m(w,{user:e,editable:this.attrs.editable}),-100)}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map